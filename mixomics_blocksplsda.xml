<tool id="mixomics_blocksplsda" name="mixOmics block.splsda" version="0.1.0" profile="16.04" workflow_compatible="true">

    <description>performs N-integration  and  feature  selection  with  Projection  to  Latent  Structures models (PLS) with sparse Discriminant Analysis</description>
    
    <requirements>
        <requirement type="package" version="6">bioconductor-mixomics</requirement>
        <requirement type="package" version="2">r-argparse</requirement>
    </requirements>
    
<!--     <stdio>
        <exit_code range="1:" level="fatal" />
    </stdio> -->

    <command detect_errors="aggressive">
        <![CDATA[
        mkdir outdir
        && Rscript
        ${__tool_directory__}/mixomics_blocksplsda_script.R
        #for $b in $blocks
            --block
            #if $b.block_name
                ${b.block_name}
            #else
                ${b.block.name}
            #end if
            ${b.keep}
            ${b.data_matrix}
            ${b.variable_metadata}
        #end for
        --sample_metadata_in ${sample_metadata_in}
        --sample_description_col ${sample_description_col}
        --ncomp ${ncomp}
        ${correlation}
        --scheme ${adv.scheme}
        --mode ${adv.mode}
        --maxiter ${adv.maxiter}
        ${adv.scale}
        --init ${adv.init}
        --tol ${adv.tol}
        ${adv.nearzerovar}
        --rdata_out ${rdata_out}
        --sample_metadata_out ${sample_metadata_out}
        --variable_metadata_outdir outdir
        ]]>
    </command>

    <inputs>
        <repeat name="blocks" title="Blocks">
            <param name="block_name" type="text" label="Block name" />
            <param name="keep" type="integer" value="0" min="0" label="Number of variables to select for each component" help="Default is to keep all variables" />
            <param name="data_matrix" type="data" format="tabular" label="Data matrix" help="rows = variables, columns = samples" />
            <param name="variable_metadata" type="data" format="tabular" optional="true" label="Variables metadata" help="rows = variables" />
        </repeat>
        <param name="sample_metadata_in" type="data" format="tabular" label="Samples metadata matrix" />
        <param name="sample_description_col" type="integer" value="0" min="0" label="Sample description column number" help="Use the last column by default" />
        <param name="ncomp" type="integer" value="2" min="1" label="Number of components to include in the model" />
        <param name="correlation" type="boolean" truevalue="--correlation" falsevalue="" checked="false" label="Correlation between all blocks"/>
        <section name="adv" title="Advanced Options" expanded="false">
            <param name="scheme" type="select" label="Scheme">
                <option value="horst" selected="true">horst</option>
                <option value="factorial"            >factorial</option>
                <option value="centroid"             >centroid</option>
            </param>
            <param name="mode" type="select" label="Mode">
                <option value="regression" selected="true">regression</option>
                <option value="canonical"                 >canonical</option>
                <option value="invariant"                 >invariant</option>
                <option value="classic"                   >classic</option>
            </param>
            <param name="maxiter" type="integer" value="100" min="1" label="Maximum number of iterations" />
            <param name="scale" type="boolean" truevalue="--scale" falsevalue="" checked="true" label="Scale" help="if checked, each block is standardized to zero means and unit variances" />
            <param name="init" type="select" label="Init">
                <option value="svd" selected="true">svd</option>
                <option value="svd.single"         >svd.single</option>
            </param>
            <param name="tol" type="float" value="1e-06" min="0" label="Convergence stopping value (tol)" />
            <param name="nearzerovar" type="boolean" truevalue="--nearzerovar" falsevalue="" checked="false" label="Should be set to TRUE in particular for data with many zero values" />
        </section>
    </inputs>

    <outputs>
        <data name="rdata_out" format="rdata" label="${tool.id}_output.rdata" />
        <data name="sample_metadata_out" format="tabular" label="${tool.id}_${sample_metadata_in.name}" />
        <collection name="blocks_output" type="list" label="${tool.id}_blocks_output">
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.tsv" directory="outdir" format="tabular" />
        </collection>
    </outputs>

<!--     <tests>
        <test>
            <repeat name="block_1">
                <param name="block_name" value="Block1" />
                <param name="keep" value="3" />
                <param name="data_matrix" value="block_1_data_matrix.tsv" />
                <param name="variable_metadata" value="block_1_meta_var.tsv" />
            </repeat>
            <repeat name="block_2">
                <param name="block_name" value="Block2" />
                <param name="keep" value="3" />
                <param name="data_matrix" value="block_2_data_matrix.tsv" />
                <param name="variable_metadata" value="block_2_meta_var.tsv" />
            </repeat>
            <param name="sample_metadata_in" value="sample_meta.tsv" />
        </test>
    </tests> -->

    <help>
        <![CDATA[
        TODO: Fill in help.
        ]]>
    </help>

    <citations>
        <citation type="doi">10.1371/journal.pcbi.1005752</citation>
    </citations>

</tool>